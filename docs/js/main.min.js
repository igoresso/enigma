(function(){'use strict';const c=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'],d=['Q','W','E','R','T','Z','U','I','O','A','S','D','F','G','H','J','K','P','Y','X','C','V','B','N','M','L'],e={i:{letter:['E','K','M','F','L','G','D','Q','V','Z','N','T','O','W','Y','H','X','U','S','P','A','I','B','R','C','J'],notch:'Q'},ii:{letter:['A','J','D','K','S','I','R','U','X','B','L','H','W','T','M','C','Q','G','Z','N','P','Y','F','V','O','E'],notch:'E'},iii:{letter:['B','D','F','H','J','L','C','P','R','T','X','V','Z','N','Y','E','I','W','G','A','K','M','U','S','Q','O'],notch:'V'}};const h=new class{constructor(t){this.rotors=Array.from(document.querySelectorAll(t)).reverse(),this.valueIndex=[]}setValue(t,u){const v=this.rotors[t],w=c.indexOf(u),x=v.querySelector('.rotors__window--active'),y=x.previousElementSibling,z=y.previousElementSibling,A=x.nextElementSibling,B=A.nextElementSibling,C=v.querySelector('.rotors__wheel'),D=25<w+1?0:w+1,E=25<w+2?w-26+2:w+2,F=0>w-1?25:w-1,G=0>w-2?w+26-2:w-2;x.value=c[w],y.innerText=c[D],z.innerText=c[E],A.innerText=c[F],B.innerText=c[G],C.style.backgroundPositionY=7*(100*w/26)+'%',this.valueIndex[t]=w}stepRotor(t){const u=25<this.valueIndex[t]+1?0:this.valueIndex[t]+1,v=c[u];this.setValue(t,v)}getCurrentState(){return this.valueIndex}bind(){for(let[t,u]of this.rotors.entries()){const v=u.querySelector('.rotors__btn--next'),w=u.querySelector('.rotors__btn--prev'),x=u.querySelector('input');v.onclick=()=>{const y=this.valueIndex[t],z=25<y+1?0:y+1;this.setValue(t,c[z])},w.onclick=()=>{const y=this.valueIndex[t],z=0>y-1?25:y-1;this.setValue(t,c[z])},x.onchange=()=>{x.validity.valid?(x.value=x.value.toUpperCase(),this.setValue(t,x.value)):x.value=''}}}reset(){for(let t=0;t<this.rotors.length;t++)this.setValue(t,'A')}init(){this.reset(),this.bind()}}('.rotors__item');const k=new class{constructor(t){this.lamps=document.querySelectorAll(t),this.lastIndex=null}newOutput(t){const u=d.indexOf(t);this.reset(),this.lamps[u].classList.add('lampboard__lamp--active'),this.lastIndex=u}reset(){const t=this.lastIndex||0;this.lamps[t].classList.remove('lampboard__lamp--active'),this.lastIndex=null}}('.lampboard__lamp');const m=new class{constructor(t){this.keys=document.querySelectorAll(t)}inputAction(t){return t}bind(){for(let t of this.keys)t.onclick=()=>{this.inputAction(t.innerText.toUpperCase())}}init(){this.bind()}}('.keyboard__btn');const o=new class{constructor(t){this.sockets=document.querySelectorAll(t),this.connections={},this.prevSocket=null}createPlug(t){const u=document.createElement('div');return u.classList.add('plugboard__plug'),u.innerText=t.toUpperCase(),u}disconnectSockets(t,u,v,w){t.remove(),u.remove(),delete this.connections[v],delete this.connections[w]}connectSockets(t,u){const v=u.getAttribute('letter'),w=t.getAttribute('letter'),x=this.createPlug(v),y=this.createPlug(w);x.onclick=z=>{z.stopPropagation(),this.disconnectSockets(x,y,v,w)},y.onclick=z=>{z.stopPropagation(),this.disconnectSockets(x,y,v,w)},t.appendChild(x),u.appendChild(y),this.connections[v]=w,this.connections[w]=v}reset(){for(let t of this.sockets){const u=t.querySelector('.plugboard__socket');u.remove}this.connections={}}bind(){for(let t of this.sockets)t.onclick=()=>{this.prevSocket&&this.prevSocket!==t?(this.connectSockets(t,this.prevSocket),t.blur(),this.prevSocket=null):this.prevSocket=t}}init(){this.bind()}}('.plugboard__socket');const q=new class{constructor(){}sumValues(t,u){return 25<t+u?t-26+u:t+u}subValues(t,u){return 0>t-u?t+26-u:t-u}encrypt(t,u,v,w){let x;const y=c.indexOf(t),z=v.length;for(let A=0;A<z;A++)x=0==A?c.indexOf(u[A][this.sumValues(v[A],y)]):c.indexOf(u[A][this.sumValues(x,this.subValues(v[A],v[A-1]))]);x=u[z-1].indexOf(c[this.sumValues(c.indexOf(w[this.subValues(x,v[z-1])]),v[z-1])]);for(let A=z-1;0<=A;A--)x=0==A?this.subValues(x,v[0]):u[A-1].indexOf(c[this.subValues(x,this.subValues(v[A],v[A-1]))]);return x=c[x],x}};const s=new class{constructor(t,u,v){this.rotorSet=t,this.rotorSetNotch=u,this.reflector=v}init(){m.init(),o.init(),h.init()}changeRotor(t,u,v){this.rotorSet[v]=t,this.rotorSetNotch[v]=u}changeReflector(t){this.reflector=t}inputAction(t){t in o.connections&&(t=o.connections[t]);const u=[0];for(let w=0;w<this.rotorSet.length-1;w++){const x=c[h.valueIndex[w]];if(x==this.rotorSetNotch[w])u.push(w+1);else break}u.forEach(w=>{h.stepRotor(w)});let v=q.encrypt(t,this.rotorSet,h.valueIndex,this.reflector);v in o.connections&&(v=o.connections[v]),k.newOutput(v)}}([e.iii.letter,e.ii.letter,e.i.letter],[e.iii.notch,e.ii.notch,e.i.notch],{B:['Y','R','U','H','Q','S','L','D','P','X','N','G','O','K','M','I','E','B','F','Z','C','W','V','J','A','T']}.B);s.init(),m.inputAction=t=>{s.inputAction(t)}})();
